<div class="main">
  <h3>{{data.oldAttribute?.attributeName == undefined ? "Добавление характеристики" : "Редактирование " + data.oldAttribute?.attributeName}}</h3>

  <mat-spinner *ngIf="isOldAttributeLoading"></mat-spinner>

  <div *ngIf="!isOldAttributeLoading">
    <mat-form-field appearance="fill" class="full-width" style="margin-bottom: 5px">
      <mat-label>Характеристика</mat-label>
      <input matInput placeholder=""
             [formControl]="searchAttributeCtrl"
             [matAutocomplete]="auto">

      <mat-hint *ngIf="selectedAttribute">
        <mat-icon style="vertical-align: top">{{selectedAttribute.isFixed ? 'check_circle' : 'radio_button_unchecked'}}</mat-icon>
        <span *ngIf="selectedAttribute.etimFeature"> [{{selectedAttribute.etimFeature}}] </span>
        {{selectedAttribute.nameAttribute}}
        <span *ngIf="selectedAttribute.unit && selectedAttribute.isFixed" class="unitMark">{{selectedAttribute.unit}}</span>
      </mat-hint>

      <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayFn" (optionSelected)="onAttributeKeySelected()">
        <mat-option *ngFor="let option of attributesList" [value]="option" > <!--<mat-icon>{{option.etimFeature? 'explicit' : 'crop_square'}}</mat-icon>-->
          <mat-icon>{{option.isFixed ? 'check_circle' : 'radio_button_unchecked'}}</mat-icon>
          <span [ngClass]="{'energomixStamp': option.supplierName == 'Энергомикс', 'supplierStamp': option.supplierName != 'Энергомикс'}">{{option.supplierName}}</span>
          <span *ngIf="option.etimFeature" style="font-style:italic "> [{{option.etimFeature}}]</span>
          <span> {{option.nameAttribute}} </span>
          <span *ngIf="option.unit && option.isFixed" class="unitMark">{{option.unit}}</span>
        </mat-option>
      </mat-autocomplete>
      <button *ngIf="searchAttributeCtrl.value;" (click)="searchAttributeCtrl.setValue('');selectedAttribute = null" matSuffix mat-icon-button aria-label="Clear" type="button">
        <mat-icon>close</mat-icon>
      </button>
    </mat-form-field>

    <mat-form-field appearance="fill" class="full-width">
      <mat-label>Значение</mat-label>
      <input matInput placeholder=""
             [formControl]="attributeValuesCtrl"
             [matAutocomplete]="attributeValuesAuto" [autofocus]="true">
      <mat-autocomplete autoActiveFirstOption #attributeValuesAuto="matAutocomplete"  (optionSelected)="onAttributeValueSelected()">
        <mat-option *ngFor="let option of filteredAttributeValues | async" [value]="option">
          {{option}}
        </mat-option>
      </mat-autocomplete>
    </mat-form-field>
    <div mat-dialog-actions class="actions-div">
      <button mat-button mat-dialog-close (click)="onCancelClick()" type="button">Отмена</button>
      <button mat-raised-button color="primary" [mat-dialog-close]="data" (click)="submitForm()" [disabled]="searchAttributeCtrl.invalid || attributeValuesCtrl.invalid">Сохранить</button>
    </div>
  </div>
</div>
