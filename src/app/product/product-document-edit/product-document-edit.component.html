<div mat-dialog-title class="header-div">
  <h3 mat-dialog-title>{{documentProduct?.certTitle == undefined ? "Добавление документа" : "Редактирование документа"}}</h3>
  <div *ngIf="!data.oldDocument">
    <button mat-button (click)="matTabGroup.selectedIndex = 0"><mat-icon>search</mat-icon> Поиск</button>
    <button mat-button (click)="matTabGroup.selectedIndex = 1"><mat-icon>add</mat-icon> Добавить новый</button>
  </div>
</div>

<mat-dialog-content>
  <mat-tab-group #matTabGroup animationDuration="0ms">
    <mat-tab *ngIf="!data.oldDocument">
      <mat-form-field appearance="fill" class="full-width">
        <mat-label>Поиск</mat-label>
        <input matInput [formControl]="searchQueryCtrl" (keydown.enter)="searchQueryChanged(searchQueryCtrl.value)">
        <button *ngIf="searchQueryCtrl.value" matSuffix mat-icon-button aria-label="Clear" (click)="searchQueryCtrl.setValue(''); searchQueryChanged('')">
          <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>

      <cdk-virtual-scroll-viewport appendOnly itemSize="50" class="viewport">
        <mat-card class="box" *ngFor="let doc of documentsList" [ngStyle]="{'background-image': 'linear-gradient(to bottom, rgba(255, 255, 255,1), rgba(255,255,255,0.5)), url(&quot;' + doc.preview + '&quot;)', 'background-size':'cover'}">

          <mat-card-header *ngIf="doc.type">
            <div mat-card-avatar><mat-icon>picture_as_pdf</mat-icon></div>
            <mat-card-subtitle><b style="color:black">{{doc.type}}</b><strong *ngIf="doc.certNumber"> № {{doc.certNumber}}</strong></mat-card-subtitle>
          </mat-card-header>

          <mat-card-content>
            <small>

              <div *ngIf="doc.certTitle"><strong>Наименование: {{doc.certTitle}}</strong></div>
            </small>
          </mat-card-content>

          <mat-card-actions align="end">

            <div class="card-low-stripe">
              <small>
                <div *ngIf="doc.startDate && doc.endDate"><strong><i>{{doc.startDate | date:'MM.yyyy'}} - {{doc.endDate | date:'MM.yyyy'}}</i></strong></div>
              </small>
            </div>

            <a mat-icon-button *ngIf="doc.url" style="color:black" href="{{doc.url}}" target="_blank"><mat-icon>remove_red_eye</mat-icon></a>&nbsp;
           <!-- <button mat-icon-button (click)="openDocumentEditorDialog(doc)"><mat-icon>edit</mat-icon></button>
            <button mat-icon-button (click)="deleteDocRow(doc)"><mat-icon>delete</mat-icon></button>-->
            <button mat-raised-button [mat-dialog-close]="data" (click)="data.newDocument = doc">Добавить</button>

          </mat-card-actions>
        </mat-card>

      </cdk-virtual-scroll-viewport>



    </mat-tab>
    <mat-tab>
      <div class="row">
        <div class="column">
          <form [formGroup]="form" (ngSubmit)="onSubmitClick()">
            <mat-form-field appearance="fill" class="full-width">
              <mat-label>Название</mat-label>
              <input matInput formControlName="certTitle" name="certTitle" required>
            </mat-form-field>

            <mat-form-field appearance="fill" class="full-width">
              <mat-label>Номер</mat-label>
              <input matInput formControlName="certNumber" name="certNumber" required>
            </mat-form-field>

            <mat-form-field appearance="fill" class="full-width">
              <mat-label>Срок действия</mat-label>
              <mat-date-range-input [formGroup]="form.get('range')" [rangePicker]="picker">
                <input matStartDate formControlName="startDate" placeholder="Начало">
                <input matEndDate formControlName="endDate" placeholder="Конец">
              </mat-date-range-input>
              <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-date-range-picker #picker></mat-date-range-picker>
            </mat-form-field>

            <mat-form-field appearance="fill" class="full-width" *ngIf="documentProduct?.type">
              <mat-label>Тип</mat-label>
              <input matInput formControlName="type">
            </mat-form-field>

            <mat-form-field appearance="fill" class="full-width" *ngIf="!documentProduct.type">
              <mat-label>Тип</mat-label>
              <mat-select formControlName="type">
                <mat-option *ngFor="let type of documentTypesList" [value]="type.descr">{{type.descr}}</mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="fill" class="full-width">
              <mat-label>Ссылка</mat-label>
              <input matInput formControlName="url" name="url">
            </mat-form-field>&nbsp;

          </form>
        </div>
        <div class="column">
          <mat-card style="height: 83%">
            <div class="uploadArea" *ngIf="!preloadDocumentView" (click)="fileInput.value=''; fileInput.click()" (drop)="onDocumentChange($event,true)" (dragover)="onDragOver($event)">
                <input #fileInput type="file" accept="application/pdf" (change)="onDocumentChange($event, false)"  style="display:none;"/>
                <mat-icon class="customIconSize">note_add</mat-icon>
                <div>
                  <span>Выберите PDF файл</span>
                  <small style="display: block">или перетащите его в эту зону</small>
                </div>
            </div>

            <ng-container *ngIf="preloadDocumentView">
              <img mat-card-image [src]="documentProduct.preview" (error)="handleMissingImage($event)" height="300" width="100%" style="object-fit: cover"/>
              <mat-list class="full-width">
                <mat-list-item>
                  <div class="document">
                    <mat-icon mat-list-icon>picture_as_pdf</mat-icon>
                    <span class="documentTitle">{{preloadDocumentView.fileName}}</span>
                    <button mat-icon-button (click)="deletePreloadDoc()"><mat-icon>close</mat-icon></button>
                  </div>
                </mat-list-item>
              </mat-list>
            </ng-container>

          </mat-card>
        </div>
      </div>

      <div class="actions-div">
        <button mat-button mat-dialog-close="" (click)="onCancelClick()" type="button">Отмена</button>
        <button mat-raised-button color="primary" (click)="onSubmitClick()" [disabled]="form.invalid">Сохранить</button>
      </div>

    </mat-tab>
  </mat-tab-group>

</mat-dialog-content>

