<div class="mat-headline">
  <div style="float:right; margin-right: 10px">
    <button mat-raised-button (click)="goToEdit(productId)">Редактировать</button>&nbsp;
    <button *ngIf="!product.internalCode" mat-raised-button>В ассортимент</button>
  </div>

  <div>
    <span *ngIf="product?.vendor">{{product?.vendor}}</span>
    <span> {{product.title !== null ? product.title : product.titleLong}}</span>
    <strong *ngIf="product.vendorId"> [{{product.vendorId}}]</strong>
    <span *ngIf="product.internalCode"> {{product.internalCode}}</span>
  </div>
</div>

<div class="container">

  <div>
    <mat-card style="padding-top: 0">
      <mat-tab-group style="width:465px" animationDuration="0ms">
        <mat-tab *ngIf="product?.images" label="Фото">
          <ng-template matTabContent>

            <app-hover-image-slider [imgList]="product.images"></app-hover-image-slider>
          </ng-template>
        </mat-tab>
<!--        *ngIf="product.image360"-->
        <mat-tab *ngIf="product.image360" label="Фото 360">
          <ng-template matTabContent>
            <iframe width="100%" height="440" [src]="safeImg360Url" title="360ImageViewer" allowfullscreen></iframe>
          </ng-template>
        </mat-tab>

        <mat-tab *ngIf="product.videos.length >= 1" label="Видео">
          <ng-template matTabContent>
              <iframe width="100%" height="440" [src]="safeVideoUrl" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
          </ng-template>
        </mat-tab>
      </mat-tab-group>
    </mat-card>


    <mat-accordion  *ngIf="product?.netto">
      <mat-expansion-panel disabled expanded style="margin-right: 10px; margin-bottom: 10px; margin-top: 10px">
        <app-package-card [pack]="product?.netto"></app-package-card>
      </mat-expansion-panel>
    </mat-accordion>

    <mat-accordion>
      <mat-expansion-panel *ngFor="let pack of product?.packages">
        <mat-expansion-panel-header>
          <mat-panel-title>
            <span>{{pack.packQty ? pack.packQty : 1}} {{pack.type}} [{{pack.barcode}}]</span>
          </mat-panel-title>
          <mat-panel-description>

          </mat-panel-description>
        </mat-expansion-panel-header>
        <app-package-card [pack]="pack"></app-package-card>
      </mat-expansion-panel>
    </mat-accordion>

  </div>




  <div style="width: 100%">

    <mat-card>
      <mat-card-subtitle>
          <h2>О товаре</h2>
      </mat-card-subtitle>

      <div [innerHTML]="product.description"></div>

      <ul>
        <li *ngIf="product.country" matTooltip="Код страны{{product.id}}">Страна производства - {{product.country}} (Код {{product.countryCode}})</li>
        <li *ngIf="product.internalCode">Артикул 1С - {{product.internalCode}}</li>
        <li *ngIf="product.vendorId">Артикул поставщика - {{product.vendorId}}</li>
        <li *ngIf="product.vendor">Вендор - {{product.vendor}}</li>
        <li *ngIf="product.supplierName">Поставщик - {{product.supplierName}}</li>
      </ul>
    </mat-card>

    <mat-card style="margin-top: 10px;" *ngIf="product.documents && product.documents.length > 0">
      <mat-card-subtitle><h2>Документы</h2></mat-card-subtitle>
      <mat-list>
        <mat-list-item *ngFor="let d of product.documents" style="height: auto">
          <div mat-line><strong>{{d.type}}</strong> <span style="font-style: italic" *ngIf="d.startDate || d.endDate">  ({{d.startDate | date:'dd-MM-yyyy'}} - {{d.endDate | date:'dd-MM-yyyy'}})</span></div>
          <div mat-line>{{d.certTitle}}</div>
          <a mat-icon-button class="mat-elevation-z2" *ngIf="d.url" style="color:black" href="{{d.url}}" target="_blank"><mat-icon>download</mat-icon></a>
        </mat-list-item>
      </mat-list>
    </mat-card>

    <mat-card style="margin-top: 10px;" *ngIf="product.attributes && product.attributes.length > 0">
      <mat-card-subtitle><h2>Характеристики</h2></mat-card-subtitle>
      <table mat-table [dataSource]="dataSource" class="full-width">

        <!-- Name Column -->
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef> Характеристика </th>
          <td mat-cell *matCellDef="let row"> {{row.attributeName}} </td>
        </ng-container>

        <!-- Value Column -->
        <ng-container matColumnDef="value">
          <th mat-header-cell *matHeaderCellDef> Значение </th>
          <td mat-cell *matCellDef="let row"> {{row.value}} </td>
        </ng-container>

        <!-- unit Column -->
        <ng-container matColumnDef="unit">
          <th mat-header-cell *matHeaderCellDef> Ед. Изменерния </th>
          <td mat-cell *matCellDef="let row"> {{row.unit}} </td>
        </ng-container>

        <!-- Etim Column -->
        <ng-container matColumnDef="etim">
          <th mat-header-cell *matHeaderCellDef> Значение </th>
          <td mat-cell *matCellDef="let row"> <mat-icon *ngIf="row.etimFeature" matTooltip="{{row.etimFeature}}">explicit</mat-icon>  </td>
        </ng-container>

        <!-- action Column -->
        <ng-container matColumnDef="action">
          <th mat-header-cell *matHeaderCellDef></th>
          <td mat-cell *matCellDef="let item">
            <button mat-icon-button class="mat-elevation-z2" matTooltip="Заменить" (click)="swapItem(item.attributeName, item.attributeId)">
              <mat-icon>swap_horiz</mat-icon>
            </button>&nbsp;
            <button mat-icon-button class="mat-elevation-z2" matTooltip="Удалить" (click)="deleteAttr(item.attributeId)" *ngIf="!item.fixed">
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-row *matRowDef="let row; columns: displayedAttrColumns;"></tr>
      </table>

    </mat-card>


  </div>
</div>




