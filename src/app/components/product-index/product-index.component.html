<div class="header-container" style="display: inline-flex; align-items: center;">
  <h3>Товары &nbsp;</h3>
  <mat-spinner diameter="35" *ngIf="dataSource.loading$ | async"></mat-spinner>
</div>

<div class="page-container">
  <div class="left-panel">
    <form>
    <mat-form-field appearance="fill" class="full-width">
      <mat-label>Поиск</mat-label>
      <input matInput [formControl]="searchQueryCtrl" (keydown.enter)="onQueryChanged()">
    </mat-form-field>
    <br />
    <app-supplier-autocomplete class="full-width" (selectedSupplier)="handleChangeSelectedSupplier($event)" [cookieSupplier]="selectedSupplier"></app-supplier-autocomplete>

      <!--[formControl]="withInternalCode"-->
    <mat-button-toggle-group [formControl]="withInternalCodeCtrl" class="full-width" (change)="onQueryChanged()">
      <mat-button-toggle [value]=false class="full-width">Все товары</mat-button-toggle>
      <mat-button-toggle [value]=true class="full-width">Только с артикулом</mat-button-toggle>
    </mat-button-toggle-group>

<!--      <hr>-->
<!--      <button mat-button>Apply</button>-->
<!--      <mat-accordion style="margin-top: 10px" class="full-width" appearance="fill">-->
<!--        <mat-expansion-panel *ngFor="let item of attributesForFilter">-->
<!--          <mat-expansion-panel-header>-->
<!--            <mat-panel-title>-->
<!--              {{item.nameAttribute}}-->
<!--              {{item.allValue.length}}-->
<!--            </mat-panel-title>-->
<!--          </mat-expansion-panel-header>-->

<!--          <mat-form-field class="full-width" appearance="fill">-->
<!--              <mat-label>{{item.nameAttribute}}</mat-label>-->
<!--              <mat-select multiple [formControl]="attributeValueFilterCtrl" panelClass="select-long-panel">-->
<!--&lt;!&ndash;                <mat-select-trigger>&ndash;&gt;-->

<!--&lt;!&ndash;                </mat-select-trigger>&ndash;&gt;-->
<!--                <mat-card style="height: 370px">-->
<!--                  <mat-form-field class="full-width" appearance="fill">-->
<!--                    <mat-label>Поиск</mat-label>-->
<!--                    <input matInput #filterSearch (input)="filtrationSearch(filterSearch, item.id)" [autofocus]="true">-->
<!--                  </mat-form-field>-->
<!--                  <cdk-virtual-scroll-viewport itemSize="10" class="attributeFilter-viewport" style="height: 300px">-->
<!--                    <mat-option *cdkVirtualFor="let value of item.allValue" [value]="value" class="multiline-mat-option" (onSelectionChange)="attributeValueChecked($event ,item.nameAttribute,value)">{{value}}</mat-option>-->
<!--                  </cdk-virtual-scroll-viewport>-->
<!--                </mat-card>-->
<!--              </mat-select>-->
<!--            </mat-form-field>-->
<!--        </mat-expansion-panel>-->
<!--      </mat-accordion>-->

    </form>
  </div>
  <div class="mat-elevation-z8 full-width" >
    <table mat-table [dataSource]="dataSource">
      <!-- Preview Column -->
      <ng-container matColumnDef="preview" >
        <th mat-header-cell *matHeaderCellDef>Фотографии</th>
        <td mat-cell *matCellDef="let row">

          <ng-template #t [ngTemplateOutlet]="t" let-a [ngTemplateOutletContext]="{ $implicit: 0 }" >
            <div *ngIf="row.thumbnails.length == 0">
              <div class="containerCmain" *ngIf="hoverRowId==row.id">
                <div class="imgWrapper">
                  <img (error)="handleMissingImage($event)" [src]="hoverImage"  class="imgInContainer" />
                </div>

                <div class="containerC">
                  <div *ngFor="let image of row.images; index as i" class="hoverBlockC" (mouseover)="changeImage(row, image)" (click)="openDialog(image)"></div>
                </div>
              </div>
              <div class="containerCmain" *ngIf="hoverRowId!=row.id">
                <div class="imgWrapper">
                  <img (error)="handleMissingImage($event)" [src]="row.images[0]" class="imgInContainer"/>
                </div>
                <div class="containerC">
                  <div *ngFor="let image of row.images; index as i" class="hoverBlockC" (mouseover)="changeImage(row, image)"></div>
                </div>
              </div>
            </div>

            <div *ngIf="row.thumbnails.length > 0">
              <div class="containerCmain" *ngIf="hoverRowId==row.id">
                <div class="imgWrapper">
                  <img [src]="hoverImage"  class="imgInContainer" />
                </div>
                <div class="containerC">
                  <div *ngFor="let thumbnail of row.thumbnails; index as i" class="hoverBlockC" (mouseover)="changeImage(row, thumbnail)" (click)="openDialog(row.localImages[i])"></div>
                </div>
              </div>
              <div class="containerCmain" *ngIf="hoverRowId!=row.id">
                <div class="imgWrapper">
                  <img  [src]="row.localImages[0]" class="imgInContainer"/>
                </div>
                <div class="containerC">
                  <div *ngFor="let image of row.localImages; index as i" class="hoverBlockC" (mouseover)="changeImage(row, image)"></div>
                </div>
              </div>
            </div>

          </ng-template>

        </td>
      </ng-container>

      <!-- internalCode Column -->
      <ng-container matColumnDef="internalCode">
        <th mat-header-cell *matHeaderCellDef>Артикул</th>
        <td mat-cell *matCellDef="let row"><b>{{row.internalCode}}</b></td>
      </ng-container>

      <!-- Name Column -->
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>Наименование товара</th>
        <td mat-cell *matCellDef="let row">

          <ng-template #t [ngTemplateOutlet]="t"
                       let-a [ngTemplateOutletContext]="{ $implicit: 0 }">
          <div>
            <h4><a href="/product-details/{{row.id}}"><span *ngIf="row.vendor">[{{row.vendor}}]</span> {{row.title}} </a> </h4>
            <p style="font-style: italic"><strong>{{row.vendorId}}&nbsp;<button class="btnAsText" (click)="copyVendorId(row.vendorId)"><mat-icon style="vertical-align:bottom;font-size:18px">content_copy</mat-icon></button></strong></p>
            <p><strong>{{row.netto?.barcode || ""}}</strong></p>
          </div>

          </ng-template>

        </td>
      </ng-container>

      <!-- supplier Column -->
      <ng-container matColumnDef="supplierName">
        <th mat-header-cell *matHeaderCellDef>Поставщик</th>
        <td mat-cell *matCellDef="let row">{{row.supplierName}}</td>
      </ng-container>

      <!-- ACTIONS Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>
          <button mat-icon-button class="mat-elevation-z2" matTooltip="Добавить товар" [routerLink]="['/product-add']">
            <mat-icon>add</mat-icon>
          </button>
        </th>
        <td mat-cell *matCellDef="let item">

          <button mat-icon-button class="mat-elevation-z2" matTooltip="Изменить товар" (click)="goToEditItem(item.id)">
            <mat-icon>edit</mat-icon>
          </button>&nbsp;
          <button mat-icon-button class="mat-elevation-z2" matTooltip="Удалить товар" (click)="confirmDeleteDialog(item.id, item.title)">
            <mat-icon>delete</mat-icon>
          </button>

        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="element-row"></tr>
    </table>
    <mat-paginator [length]="dataSource.rowCount" showFirstLastButtons [pageSize]="10" [pageSizeOptions]=[10,20,50,100] aria-label="Страница">
    </mat-paginator>
  </div>

</div>
